//###################################################################################################
// Create Function

module.exports.create = function(_config) {
    return new Handler(_config);
};

//###################################################################################################
// Basic Object
function Handler(_config) {
    /////////////////////////////////////////////////////////////////////////////////////////////////
   
    var 
    ////=============================================================================================
    // Requirements
        
        irc = require('irc'),
    
    ////=============================================================================================
    // Propertys
    
        self = this,
        ircServer,
        config,
    
    ////=============================================================================================
    // Methods
    
        ////-----------------------------------------------------------------------------------------
        // Function
        init = function(_config) {
            
            if( _config !== undefined )
                config = _config;
            else
                console.error('[ircHandler] Options undefined');
            
            events.EventEmitter.call(this);
                        
            ircServer = new irc.Client(config.host, config.name, {channels: [config.channel]});
            ircServer.addListener('message', onMessage);
            ircServer.addListener('names', onNickList);  
            
            self.on('send', send);
        },
        
        onMessage = function(from, to, message) {
            self.emit('message', from, to, message);
        },
        
        onNickList = function(channel, nicks) {
            self.emit('nicklist', channel, nicks);
        },
        
        send = function(message) {
            ircServer.say(config.channel, message);   
        }

    ////=============================================================================================
    ;

    /////////////////////////////////////////////////////////////////////////////////////////////////

    init(_config);
    
    /////////////////////////////////////////////////////////////////////////////////////////////////
}

//###################################################################################################
// Inherit from EventEmitter

events = require('events');
Handler.super_ = events.EventEmitter;
Handler.prototype = Object.create(events.EventEmitter.prototype, {
    constructor: {
        value: Handler,
        enumerable: false
    }   
});
