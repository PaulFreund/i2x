//###################################################################################################
// Create Function

module.exports.create = function(_events, _config) {
    return new Handler(_events, _config);
};

//###################################################################################################
// Basic Object
function Handler(_events, _config) {
    /////////////////////////////////////////////////////////////////////////////////////////////////
   
    var 
    ////=============================================================================================
    // Requirements
    
    ////=============================================================================================
    // Propertys
    
        name = 'router',
        self = this,
        config,
    
    ////=============================================================================================
    // Methods
    
        ////-----------------------------------------------------------------------------------------
        // Initialize
        init = function(_events, _config) {
            if( _events !== undefined )
                events = _events;
            else
                console.error('['+name+']EventEmitter undefined');
            
            if( _config !== undefined )
                config = _config;
            else
                events.emit('error', name, 'Options undefined');
                        
            events.on('irc', onIRC);
            events.on('xmpp', onXMPP);
            events.on(name, onEvent);
        },

        ////-----------------------------------------------------------------------------------------
        // IRC Message        
        onIRC = function(type) {
            if( type == 'message' ) {
                logstring = '[IRC] '+ arguments[1] +': ' + arguments[3];
                events.emit('store', 'set', 'log'+'.'+Date.now(), logstring);
                events.emit('xmpp', 'send', 'bigwookie@saftsack.org', arguments[3]);
            }
        },
        
        ////-----------------------------------------------------------------------------------------
        // XMPP Message
        onXMPP = function(type) {
            if( type == 'message' ) {
                logstring = '[JAB] '+ arguments[1] +': ' + arguments[3];
                events.emit('store', 'set', 'log'+'.'+Date.now(), logstring);
                events.emit('irc', 'say', '#shadowmind', arguments[3]);
            }
        },

        ////-----------------------------------------------------------------------------------------
        // Decide which function should handle the event
        onEvent = function(type) {
            var args = Array.prototype.slice.call(arguments, 1);
            
            try {
                switch(type) {    
                }
            }
            catch( err )
            {
                events.emit('error', name, err);   
            }
        }



    ////=============================================================================================
    ;

    /////////////////////////////////////////////////////////////////////////////////////////////////

    init(_events, _config);
    
    /////////////////////////////////////////////////////////////////////////////////////////////////
}

